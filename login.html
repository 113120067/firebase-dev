<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>登入 — 範例</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans CJK TC", "Helvetica Neue", Arial; padding: 20px; }
    .card { border:1px solid #ddd; padding:20px; border-radius:8px; max-width:480px; margin-bottom:12px; }
    input { display:block; width:100%; padding:8px; margin:8px 0; box-sizing:border-box; }
    button { padding:8px 12px; border-radius:6px; border:1px solid #bbb; background:#f6f6f6; cursor:pointer; margin-right:8px; }
  </style>
</head>
<body>
  <h1>登入 / 註冊（範例）</h1>

  <div class="card">
    <h2>使用 Google 登入</h2>
    <button id="btn-google">以 Google 帳戶登入</button>
  </div>

  <div class="card">
    <h2>使用 Email / Password</h2>
    <form id="form-email">
      <label>電子郵件
        <input type="email" id="email" required />
      </label>
      <label>密碼
        <input type="password" id="password" required minlength="6" />
      </label>
      <div>
        <button id="btn-signin" type="button">登入</button>
        <button id="btn-signup" type="button">註冊</button>
      </div>
    </form>
    <div id="msg" style="color:crimson; margin-top:8px;"></div>
  </div>

  <script type="module">
    import { initialize, signInWithGoogle, signUp, signIn, onAuthStateChanged } from './firebase-config.js';

    // 初始化（必須）
    await initialize();

    const btnGoogle = document.getElementById('btn-google');
    const btnSignUp = document.getElementById('btn-signup');
    const btnSignIn = document.getElementById('btn-signin');
    const emailEl = document.getElementById('email');
    const pwEl = document.getElementById('password');
    const msg = document.getElementById('msg');

    btnGoogle.addEventListener('click', async () => {
      msg.textContent = '';
      try {
        await signInWithGoogle();
        // 成功後 onAuthStateChanged 會觸發並重導到受保護頁面
      } catch (err) {
        console.error(err);
        msg.textContent = err.message;
      }
    });

    btnSignUp.addEventListener('click', async () => {
      msg.textContent = '';
      try {
        await signUp(emailEl.value, pwEl.value);
        // 成功後會自動登入
      } catch (err) {
        console.error(err);
        msg.textContent = err.message;
      }
    });

    btnSignIn.addEventListener('click', async () => {
      msg.textContent = '';
      try {
        await signIn(emailEl.value, pwEl.value);
      } catch (err) {
        console.error(err);
        msg.textContent = err.message;
      }
    });

    // 如果使用者已登入，直接導向受保護頁面
    onAuthStateChanged((user) => {
      if (user) {
        window.location.href = 'index.html';
      }
    });
  </script>
</body>
</html>